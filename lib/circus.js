!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Circus=n():t.Circus=n()}(this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var u=e[r]={exports:{},id:r,loaded:!1};return t[r].call(u.exports,u,u.exports,n),u.loaded=!0,u.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){var r,u,i;!function(f,a){u=[n,e(2),e(1),e(5)],r=a,i="function"==typeof r?r.apply(n,u):r,!(void 0!==i&&(t.exports=i))}(this,function(t,n,e,r){"use strict";function u(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(t,"__esModule",{value:!0}),t.test=t.Error=t.Circuit=void 0;var i=u(n),f=u(e);f["default"].Circuit=i["default"],t.Circuit=i["default"],t.Error=r.Error,t.test=r.test,t["default"]=f["default"]})},function(t,n,e){var r,u,i;!function(e,f){u=[n],r=f,i="function"==typeof r?r.apply(n,u):r,!(void 0!==i&&(t.exports=i))}(this,function(t){"use strict";function n(t,e){var r=[].slice.call(arguments,2);return e&&(Object.keys(e).forEach(function(n){t[n]=e[n]}),r.unshift(t),t=n.apply(null,r)),t}function e(t){return this instanceof e?void(this.value=t):new e(t)}Object.defineProperty(t,"__esModule",{value:!0});var r={}.toString,u="A",i="O",f="F",a="SNBDR",o=function(t){return r.call(t)[8]},c=function(t){return t=o(t),~a.indexOf(t)&&a||t};o.ARRAY=u,o.OBJECT=i,o.FUNCTION=f,o.LITERAL=a;var l={UNDEFINED:Object.freeze({value:void 0}),extend:n,fail:e,typeOf:c,type:o};t.extend=n,t.fail=e,t["default"]=l})},function(t,n,e){var r,u,i;!function(f,a){u=[n,e(1),e(3),e(4)],r=a,i="function"==typeof r?r.apply(n,u):r,!(void 0!==i&&(t.exports=i))}(this,function(t,n,e,r){"use strict";function u(t){return t&&t.__esModule?t:{"default":t}}function i(t,n,e){if(!e||void 0===n)return t!==n;for(var r=0,u=Object.keys(t);u.length>r;r++)if(t[u[r]]!==n[u[r]])return!0;return!1}function f(t,n){if(n===l["default"].UNDEFINED&&(n=function(t){return t}),!l["default"].isSignal(n)){var e=n,r="object"==typeof n?"join":"map";"function"!=typeof n&&"map"===r&&(n=function(){return e}),n=t.signal()[r](n)}return n}function a(t){return function n(e,r){return r=r||t,Object.keys(e).forEach(function(t){for(var u="function"!=typeof e[t]&&e[t].length?e[t]:[null,e[t]],i=0;2>i;i++){var f=u[i];if(l["default"].isSignal(f)||"function"==typeof f){var a=r.channels[t]||r.channels[Object.keys(r.channels).find(function(n){return r.channels[n].output.name===t})].output;a.map(i&&f||l["default"].before(f))}else f&&n(f,r.channels[t])}}),this}}function o(t){var n=t.prime.bind(t);return function(t){var e=this;return"object"==typeof t&&e.channels&&Object.keys(t).filter(function(t){return e.channels[t]}).forEach(function(n){e.channels[n].prime(t[n])}),n(t)}}function c(){function t(t,n,r){function u(e){p[e]=s[e].name||e;return function(e,r){var u={};if(n&&!r)for(var i=0,f=s.length;f>i;i++){var o=s[i];u[p[i]]=o.value()}else u=e;v(r||(t?a.value():u))}}var a=this.asSignal().pure(!t&&i);a.isJoin=n||a.isJoin;var o=[].slice.call(r);"string"==typeof o[0]&&a.name(o.shift());for(var c=a.channels||{},s=[],d=0,p=[];o.length;){var h=o.shift();l["default"].isSignal(h)?(s.push(h),c[h.name||d++]=h):Object.keys(h).forEach(function(t,n){var r=f(e,h[t]),u=r;r.id?(r.name=r.name||t,u=r.channel(l["default"].before),u.name=t,r.bind(function(t,n){return t.apply(r,n.concat(a.value()))}),u.output=r):(u={value:r().value},p[n]=t),c[t]=u,s.push(u)})}for(var v=a.step(),y=0,E=s.length;E>y;y++){var g=s[y];g["finally"]&&g["finally"](u(y))}return a.channels=c,a.map(function(n){return t?void 0:n})}var n=[],e=this,r=new d["default"](new s["default"](this));this.signal=r.create=function(t){return n.reduce(function(t,n){return n="function"==typeof n?n(t):n,l["default"].extend(t,n)},new r(t))},this.asSignal=function(){return this.signal()},this.join=function(){return t.call(this,!1,!0,arguments)},this.merge=function(){return t.call(this,!1,!1,arguments)},this.sample=function(){return t.call(this,!0,!1,arguments)},this.extend=function(t){if(n.push(t),"function"!=typeof t)return l["default"].extend(this,t)},this.extend({join:e.join,merge:e.merge,sample:e.sample}),this.extend(function(t){return{prime:o(t),overlay:a(t)}});[].slice.call(arguments).forEach(function(t){t(e)})}Object.defineProperty(t,"__esModule",{value:!0});var l=u(n),s=u(e),d=u(r);t["default"]=c})},function(t,n,e){var r,u,i;!function(e,f){u=[n],r=f,i="function"==typeof r?r.apply(n,u):r,!(void 0!==i&&(t.exports=i))}(this,function(t){"use strict";function n(t){var n=[],e=0,r=!0,u=function(){};return t.stateChange=function(t,n){_events.unshift({start:t||u,stop:n||u})},{start:function(t,u){if(!e++&&r&&n.length)for(var i=0,f=n.length;f>i;i++)n[i].start(t,u)},stop:function(t,u){if(!--e&&n.length)if(r){r=!1;for(var i=0,f=n.length;f>i;i++)n[i].stop(t,u)}else r=!0}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n})},function(t,n,e){var r,u,i;!function(f,a){u=[n,e(1)],r=a,i="function"==typeof r?r.apply(n,u):r,!(void 0!==i&&(t.exports=i))}(this,function(t,n){"use strict";function e(t){return t&&t.__esModule?t:{"default":t}}function r(t){function n(f){function c(n,e){var r;if(t.start(N,n),n instanceof u["default"].fail)r=n;else if(!m||j(n,v,N.isJoin)){v=n,r=n;for(var i=e,f=b.length;f>i&&(r=s(b[i],[n]),!(void 0===r||r instanceof u["default"].fail));i++)n=r;l(n)}if(void 0!==r)for(var a=0,o=O.length;o>a;a++)O[a].call(N,n,r instanceof u["default"].fail?r:void 0);return x!==u["default"].UNDEFINED&&l(x),t.stop(N,y),r}function l(t){g=void 0!==t||void 0,t===u["default"].UNDEFINED&&(t=void 0),y=t}function s(t,n){return t.apply(N,n)}function d(t){if(u["default"].isSignal(t))return t.value;if("object"==typeof t)for(var n in t)if(t.hasOwnProperty(n))return N.channels=N.channels||{},d(N.channels[n]=N.asSignal(t[n]));return t}function p(n){var e=d(n);if(n!==e&&n["finally"]&&n["finally"](h()),u["default"].isAsync(e)){var r=h();return function(n){t.start(N,n);try{var u=[].slice.call(arguments).concat(r);return e.apply(N,u)}finally{t.stop(N,n)}}}return e}function h(){var t=(E?b.length:D)+1;return function(n){return c(n,t)}}i.call(this,e,++r,f);var v,y,E,g,m,N=this,D=0,b=[],O=[],x=u["default"].UNDEFINED,j=o;return this.asSignal=function(t){if(u["default"].isSignal(t||this))return t||this;if(n.create){var e=n.create();return"function"==typeof t?e.map(t):e}},this.prime=function(t){return l(t),N},this.value=function(t){return arguments.length?c(t,0):y},this.step=h,this.pulse=function(t){return x=t,N},this.map=function(t){var n=t.state===a,e=p(n&&t.value||t);return n?b.unshift(e):b.splice(D,0,e),D++,N},this.channel=function(t,n){var o=u["default"].extend({},N,{constructor:i}),c=function(t){var n=t.state===a,e=p(n&&t.value||t);return n?b.splice(D,0,e):b.push(e),N};return i.call(o,e,++r,f),E=!t||t===u["default"].after,(E?!n:n)||(D=0),E?o.map=c:N.map=c,o},this.flow=function(){for(var t=[].slice.call(arguments),n=0;t.length>n;n++)this.map(t[n]);return N},this.active=function(t){return arguments.length&&(t?g=!_reset.length||_reset.pop():(_reset.push(g),g=!1)),!!g},this.bind=function(t){var n=s;return s=function(e,r){var u=function(){return n(e,arguments)};return t.call(N,u,r)},N},this["finally"]=function(t){var n=t.state===a,e=d(n&&t.value||t);if(u["default"].isSignal(e)){var r=e;e=function(t){r.value(t)}}return O[n?"unshift":"push"](e),N},this.pure=function(t){return m=t!==!1,"function"==typeof t&&(j=t),N},this.tap=function(t){return this.map(function(n){return t.apply(N,arguments),void 0===n?u["default"].UNDEFINED:n})},this.extend=function(t){return t="function"==typeof t?t(this):t,u["default"].extend(this,t)},N}var e=++c,r=0;return n.prototype=i.prototype,n.prototype.constructor=i,n}Object.defineProperty(t,"__esModule",{value:!0});var u=e(n),i=function(t,n,e){this.name=e;var r=this;this.id=function(){return r},this.id.constructor=i};u["default"].isSignal=function(t){return t&&t.constructor===i};var f="after",a="before",o=function(t,n){return t!==n},c=0,l=/\((.+)\)\s*==>|function\s*.*?\(([^)]*)\)/;u["default"].isAsync=function(t){var n=(""+t).match(l);return n&&(n[1]||n[2]).indexOf("next")>0},u["default"].after=function(t){return{state:f,value:t}},u["default"].before=function(t){return{state:a,value:t}},t["default"]=r})},function(t,n,e){var r,u,i;!function(f,a){u=[n,e(1)],r=a,i="function"==typeof r?r.apply(n,u):r,!(void 0!==i&&(t.exports=i))}(this,function(t,n){"use strict";function e(t){return t&&t.__esModule?t:{"default":t}}function r(t,n,e){var u=c["default"].type(t);if(~c["default"].type.LITERAL.indexOf(u)||u===c["default"].type.FUNCTION||void 0===t||void 0===n||c["default"].isSignal(t))return t!==n;if(u===c["default"].type.ARRAY)return t.length!==n.length||t.some(function(t,u){return e?r(t,n[u],e):t!==n[u]});if(u===c["default"].type.OBJECT){var i=Object.keys(t),f=Object.keys(n);return i.length!=f.length||"object"!=typeof n||i.some(function(u,a){return e?r(t[u],n[u],e):t[u]!==n[u]||i[a]!==f[a]})}return!1}function u(t,n){var e=n.indexOf("[");if(e>0){var r=parseInt(n.substr(e+1,n.length-2),10),u=n.substr(0,e);return t.hasOwnProperty(u)?t[u][r]:c["default"].UNDEFINED}return t&&t.hasOwnProperty(n)?t[n]:c["default"].UNDEFINED}function i(t,n,e,r){4>arguments.length&&(r=null);var f=((e?e+".":"")+n).split("."),a=f.reduce(u,t);return t&&a===c["default"].UNDEFINED&&c["default"].typeOf(t)===c["default"].type.OBJECT&&t.constructor==={}.constructor&&(a=Object.keys(t).reduce(function(e,u){return e!==c["default"].UNDEFINED&&e||i(t[u],n,"",r)},c["default"].UNDEFINED)),a!==c["default"].UNDEFINED?a:r}function f(t,n,e,r){function u(n,r,i){var o={};return Object.keys(n).forEach(function(l){var s=n[l],d=c["default"].isSignal(s)&&s.name||l,p=(i||{})[d];if(s.channels&&s.channels!==t.channels){var h=u(s.channels,r,p);o[d]=h[0],e=h[1]}else a.push(e=o[d]=r.apply(null,f?[e,s,p]:[s,p]))}),[o,e,a]}var i=t.channels||c["default"].isSignal(t)&&{s:t}||t,f=e!=c["default"].UNDEFINED,a=[];return n=n||function(t){return t},u(i,n,r)}function a(t){return!this instanceof a?new a(t):void t.extend(function(t){var n;t["finally"](function(t,e){e&&(n=n||e.value||!0)});var e=l.flatmap(t);return{active:function(n){return t.map(function(t){for(var r=0;e.length>r;r++)if(!e[r].active())return c["default"].fail(n||"required");return t})},error:function(t){if(n){var t=n;return n=!1,t||!0}return""}}})}function o(t,n){return c["default"].isAsync(t)?function(e,r){return t.call(this,e,function(t){return r(t?t===!0?e:t:c["default"].fail(n))})}:function(e){var r=t.call(this,e);return r?r===!0?e:r:c["default"].fail(n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Error=a,t.test=o;var c=e(n);const l={diff:function(t,n){return r(t,n)},deepDiff:function(t,n){return r(t,n,!0)},equal:function(t,n){return!r(t,n)},deepEqual:function(t,n){return!r(t,n,!0)},lens:i,reduce:function(t,n,e,r){return f(t,n,e,r)[1]},map:function(t,n,e){return f(t,n,c["default"].UNDEFINED,e)[0]},flatmap:function(t,n,e){return f(t,n,c["default"].UNDEFINED,e)[2]},tap:function(t,n,e){f(t,n,c["default"].UNDEFINED,e)},test:o};t["default"]=l})}])});