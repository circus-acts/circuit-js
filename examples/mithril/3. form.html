<html>
<head>
<style>
  label {display:block; width:200px;text-align: right;}
  span,input {margin:5px;}
</style>
<script src="../../node_modules/mithril/mithril.js"></script>
<script src="../../src/circus.js"></script>
<script src="../../src/model.js"></script>
<script src="../../src/view.js"></script>
<script src="../../src/intent.js"></script>
<script src="../../src/signal.js"></script>
<script src="../../src/composables.js"></script>
<script src="../../libraries/mithril-circus.js"></script>
</head>
<body>
<script>

  var model = circus.model().finally().match({
    login,
    register,
    specials
  })
  var login = model.pluck('user').httpPost('/login')
  var register = model.pluck('user','details').httpPost('/register')
  var specials = circus.signal().sample(login,register).httpGet('/specials')

  var view = circus.view().map(function(m){
    return m.specials? specials(m.specials) : login(m.user)
  })

  function login(model) {
    return m('div', [
      m('h1', 'Please login or register'),
      m('input#email'),
      m('password'),
      m('input#register', {type:'checkbox'}),
      model.register
        ? m('div',[
            m('typeahead#postcode'),
            m('address')
          ])
        : ''
    ])
  }

  var intent = circus.intent().validate()

  m.route(document.body,'/login', {
    '/login': circus.stage(model, login, intent)),
    '/specials': circus.stage(model, specials, intent))
  })

</script>
</body>
</html>