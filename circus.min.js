/*
Circus.js v0.0.2
http://github.com/philtoms/circus.js
(c) Phil Toms
License: MIT
*/
var circus=function(){"use strict";function a(){}function b(a,b){if("object"==typeof a){if(a.length)return a.slice();var c={};return Object.keys(a).forEach(function(d){c[d]=b&&void 0!==b[d]?b[d]:a[d]}),c}return a}function c(a,c){return void 0===a?b(c):b(a,c)}function d(a,b,c){var e=n.call(a)[8];if(~q.indexOf(e)||void 0===a||void 0===b)return a!==b;if(e===o)return a.length!==b.length||a.some(function(a,e){return c?d(a,b[e]):a!==b[e]});if(e===p){var f=Object.keys(a),g=Object.keys(b);return f.length!=g.length||"object"!=typeof b||f.some(function(e,h){return c?d(a[e],b[e],c):a[e]!==b[e]||f[h]!==g[h]})}return!1}function e(a,b){return d(a,b,!0)}function f(a,b){return!d(a,b)}function g(a,b){return!d(a,b,!0)}function h(a,b){var c=b.indexOf("[");if(c>0){var d=parseInt(b.substr(c+1,b.length-2),10),e=b.substr(0,c);return a[e][d]}return a&&(a.hasOwnProperty("channels")?a.channels[b]:a[b])}function i(a,b,c,d){arguments.length<4&&(d=null);var e=((c?c+".":"")+b).split("."),f=e.reduce(h,a);return void 0!==f?f:d}function j(a,b,c){return m(a,b,c)[1]}function k(a,b){return m(a,b)[0]}function l(a,b){m(a,b)}function m(a,b,c){function d(b,e){var g={};return b.forEach(function(b){var h=b.name;if(b.channels&&b.channels!==a.channels){var i=d(b.channels,e,c);g[h]=i[0],c=i[1]}else c=g[h]=e.apply(null,f?[c,b]:[b])}),[g,c]}var e=a.channels,f=3===arguments.length;return d(e,b)}var n={}.toString,o="A",p="O",q="SNBDR",r={id:function(a){return a},noop:function(){},copy:b,merge:c,diff:d,deepDiff:e,equal:f,deepEqual:g,lens:i,map:k,reduce:j,tap:l,typeOf:function(a){return a=n.call(a)[8],~q.indexOf(a)&&q||a}};return r.typeOf.ARRAY=o,r.typeOf.OBJECT=p,r.typeOf.LITERAL=q,Object.keys(r).forEach(function(b){a[b]=r[b]}),a}();"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circus:"function"==typeof define&&define.amd&&define(function(){return circus});var signal=function(a){"use strict";function b(f){function g(b,c,d){if(l||void 0===l){for(var e=d,f=n.length;f>e;e+=1){var g=n[e].call(b,c);if(void 0===g)break;if(g===a.FALSE)return;c=g===a.UNDEFINED?void 0:g}h(c);for(var e=0,f=o.length;f>e;e+=1)o[e].call(b,c)}}function h(b){l=!0;var c=void 0===m.value?b:!s(b,m.value)&&a.FALSE||b;m={dirty:c,value:b},r>1?(k.length===r&&k.shift(),k.push(m)):k=m}function i(c,d,e,f){function g(a,b){var c,f=o[a]=j[a].name||a;return function(g){if(c=!0,e||d){for(var i={},k=0,l=j.length;l>k;k++){var p=j[k];c=c&&p.active(),i[o[k]]=n[o[k]]}n=i,n[f]=g}else n=g;return(c||h===j[a])&&q(d?m:n),b}}for(var h,i=[].slice.call(f),j=[],k=(c.namespace?c.namespace+".":"")+c.name;i.length;){var l=i.shift();l===a.id&&(h=c,l=c),l instanceof b?j.push(l):Object.keys(l).forEach(function(a){var d=l[a];d instanceof b||(d=new b([a,k]).join(d)),d.parent=c,d.name=d.name||a,d.namespace=k,j.push(d)})}for(var m,n={},o=[],q=c.step(h||d?p+1:p),r=0,s=j.length;s>r;r++){var t=j[r],u=t===h?a.FALSE:void 0;t[u?"map":"finally"](g(r,u))}return c.channels=j,d?c.map(function(){})["finally"](function(a){m=a}):c}var j,k,l,m=c,n=[],o=[],p=0,q=a.UNDEFINED,r=1,s=function(a,b){return a!==b};if(this.id=++e,this.name="",this.namespace="",this.head=function(){return j},this.prime=function(a){return h(a),this},this.value=function(b){if(q!==a.UNDEFINED){var c=q;q=a.UNDEFINED;for(var d=0,e=c.length;e>d;d++)h(c[d])}return arguments.length&&(j=b,g(this,b,0)),m.value},this.step=function(a){var b=this;return void 0===a&&(a=p+1),function(c){g(b,c,a)}},this.active=function(a){if(arguments.length){this.parent&&this.parent.active(a);var b=l;return l=void 0===a?void 0:!!a,b}return!!l},this.diff=function(a){return s=a,this},this.map=function(a){return n.push(a),p=n.length,this},this["finally"]=function(a){return o.unshift(a),this},this.keep=function(a){return r=arguments.length?a:d,r>1&&void 0===k&&(k=[]),this},this.history=function(){return r?(r>1?k:[k]).map(function(a){return a.value}):void 0},this.dirty=function(){return m.dirty!==a.FALSE},this.tap=function(a){return this.map(function(b){return a.call(this,b),b})},this.join=function(){return i(this,!1,!0,arguments)},this.merge=function(){return i(this,!1,!1,arguments)},this.sample=function(){return i(this,!0,!1,arguments)},this.feed=function(){var a=[].slice.call(arguments);return this.map(function(b){a.forEach(function(a){a.value(b)})})},void 0!==f&&void 0!==f[0]){var t=this,u=0,v=[];[].slice.call(f).forEach(function(a){"string"==typeof a?u++?t.namespace=a:t.name=a:a instanceof b?v.push(a):q=a}),v.length&&this.feed.apply(this,v)}}a=a||require("circus"),a.TRUE=Object.freeze({state:!0}),a.FALSE=Object.freeze({state:!1}),a.UNDEFINED=Object.freeze({state:void 0});var c=Object.freeze({dirty:a.FALSE,value:void 0}),d=Number.MAX_SAFE_INTEGER||-1>>>1,e=0;return b.prototype.extend=function(a){var b=this,c="function"==typeof a?a(this):a;return Object.keys(c).forEach(function(a){b[a]=c[a]}),this},a.signal=function(){return new b(arguments)},a.signal.extendBy=function(a){Object.keys(a).forEach(function(c){b.prototype[c]=a[c]})},a.isSignal=function(a){return a instanceof b},a.signal}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=signal:"function"==typeof define&&define.amd&&define(function(){return signal});var circusLogic=function(a){"use strict";a=a||require("circus"),a.signal.extendBy({match:function(b,c,d,e){function f(a,b,c,d,e){return a.forEach(function(a){if(void 0===h[a])if("*"===a)f(Object.keys(b),b,c,c[a]);else if("*"===a[0]){var e=a.substr(1);f(Object.keys(b).filter(function(a){return a.indexOf(e)>0}),b,c,c[a])}else if("*"===a[a.length-1]){var e=a.substr(0,a.length-1);f(Object.keys(b).filter(function(a){return 0===a.indexOf(e)}),b,c,c[a])}else h[a]=void 0===d?c===b?j:c[a]:d}),e&&"object"==typeof b&&Object.keys(b).forEach(function(a){h.hasOwnProperty(a)||(h[a]=k)}),a.length}function g(b){var g=i||b;h||(h={},a.typeOf(g)===a.typeOf.OBJECT&&f(Object.keys(g),b,g,void 0,e)||(h[l]=b));var m=d,n={};return Object.keys(h).forEach(function(f){var g=b&&b.hasOwnProperty(f)?f:void 0,i=g?b[f]:b,l=void 0===h[f],o=e&&h[f]===k,p=h[f]===j||o?i:h[f],q=l||c(i,p,g);(q&&!e||o)&&(n[f]=q===!0||o?i:q===a.UNDEFINED?void 0:q),m=d?m&&(q||o):m||q}),m?n.hasOwnProperty(l)?n[l]:Object.keys(n).length?n:a.UNDEFINED:void 0}"function"==typeof b&&(d=c,c=b,b=!1),b&&b.hasOwnProperty("length")||(b=[b]);var h,i=b[0],j={},k={},l=(new Date).getTime();return i&&(b.length>1||"object"!=typeof i)&&(i=[].slice.call(b).reduce(function(a,b){return a[b]=j,a},{})),c=c||function(a,b){return i?a===b||a&&b===!0||!a&&b===!1:void 0!==a},this.map(g)},and:function(){function a(a,b){return a&&b===a||a&&b===!0||!a&&b===!1}return this.match(arguments,a,!0)},or:function(){function a(a,d,e){return c&&(d=b.value(),e&&d&&(d=d[e])),a||d}var b=this,c=!arguments.length;return this.match(arguments,a)},xor:function(){function a(a,d,e){return c&&(d=b.value(),e&&d&&(d=d[e])),a&&d!==a||!a&&d}var b=this,c=!arguments.length;return this.match(arguments,a)},not:function(){function a(a,b){return b&&a!==b||!a}return this.match(arguments,a,!0,!0)}})}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circusComposables:"function"==typeof define&&define.amd&&define(function(){return circusComposables});var circusComposables=function(a){"use strict";a=a||require("circus"),a.signal.extendBy({always:function(a){return this.map(function(){return a})},batch:function(a){var b=[],c=function(c){return b.push(c),b.length===a?(c=b,b=[],c):void 0};return this.map(c)},compact:function(){return this.map(function(b){return b||a.FALSE})},flatten:function(b){function c(e){return a.typeOf(e)===a.typeOf.ARRAY?e.forEach(c):d(b?b(e):e),a.FALSE}var d=this.step();return this.map(c)},maybe:function(a,b){return this.map(function(c){return a(c)?{just:c}:{nothing:b||!0}})},pluck:function(){var b=[].slice.call(arguments),c=b[0];return this.map(function(d){return 1===b.length&&(d[c]||a.lens(d,c))||b.reduce(function(b,c){return b[c]=a.lens(d,c),b},{})})},project:function(){var b=[].slice.call(arguments);return this.map(function(c){return b.reduce(function(b,d){return Object.keys(d).forEach(function(e){b[e]=a.lens(c,d[e])}),b},{})})},reduce:function(a,b){return this.map(function(c){if(b){var d=[b].concat([].slice.call(arguments));b=a.apply(null,d)}else b=c;return b})},skip:function(b){return this.map(function(c){return b-->0?a.FALSE:c})},take:function(b){return this.map(function(c){return b-->0?c:a.FALSE})},window:function(a){var b=[],c=function(c){return b.push(c),--a<0?(b.shift(),b):void 0};return this.map(c)},zip:function(b){b=b||[0,1];var c=b.length,d=-1,e=function(e){return++d%c===0?b.map(function(a){return e[a]}):a.FALSE};return this.map(e)},filter:function(b){return this.map(function(c){return b(c)?c:a.FALSE})},match:function(b,c,d,e){function f(a,b,c,d,e){return a.forEach(function(a){if(void 0===h[a])if("*"===a)f(Object.keys(b),b,c,c[a]);else if("*"===a[0]){var e=a.substr(1);f(Object.keys(b).filter(function(a){return a.indexOf(e)>0}),b,c,c[a])}else if("*"===a[a.length-1]){var e=a.substr(0,a.length-1);f(Object.keys(b).filter(function(a){return 0===a.indexOf(e)}),b,c,c[a])}else h[a]=void 0===d?c===b?j:c[a]:d}),e&&"object"==typeof b&&Object.keys(b).forEach(function(a){h.hasOwnProperty(a)||(h[a]=k)}),a.length}function g(b){var g=i||b;h||(h={},a.typeOf(g)===a.typeOf.OBJECT&&f(Object.keys(g),b,g,void 0,e)||(h[l]=b));var m=d,n={};return Object.keys(h).forEach(function(f){var g=b&&b.hasOwnProperty(f)?f:void 0,i=g?b[f]:b,l=void 0===h[f],o=e&&h[f]===k,p=h[f]===j||o?i:h[f],q=l||c(i,p,g);(q&&!e||o)&&(n[f]=q===!0||o?i:q===a.UNDEFINED?void 0:q),m=d?m&&(q||o):m||q}),m?n.hasOwnProperty(l)?n[l]:Object.keys(n).length?n:a.UNDEFINED:void 0}"function"==typeof b&&(d=c,c=b,b=!1),b&&b.hasOwnProperty("length")||(b=[b]);var h,i=b[0],j={},k={},l=(new Date).getTime();return i&&(b.length>1||"object"!=typeof i)&&(i=[].slice.call(b).reduce(function(a,b){return a[b]=j,a},{})),c=c||function(a,b){return i?a===b||a&&b===!0||!a&&b===!1:void 0!==a},this.map(g)},and:function(){function a(a,b){return a&&b===a||a&&b===!0||!a&&b===!1}return this.match(arguments,a,!0)},or:function(){function a(a,d,e){return c&&(d=b.value(),e&&d&&(d=d[e])),a||d}var b=this,c=!arguments.length;return this.match(arguments,a)},xor:function(){function a(a,d,e){return c&&(d=b.value(),e&&d&&(d=d[e])),a&&d!==a||!a&&d}var b=this,c=!arguments.length;return this.match(arguments,a)},not:function(){function a(a,b){return b&&a!==b||!a}return this.match(arguments,a,!0,!0)}})}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circusComposables:"function"==typeof define&&define.amd&&define(function(){return circusComposables});var circusMVI=function(a){"use strict";function b(a,b){var c,d=a[0],e=a[1];if(void 0===d||void 0===e)return[!0,void 0];if((c=b.indexOf("["))>0){var f=parseInt(b.substr(c+1,b.length-2),10),g=b.substr(0,c);return[d[g][f],e[g][f]]}return[d[b],e[b]]}function c(a,c,d){"."!==d[0]&&(d="."+d),d=("root"+d).split(".");var f=d.reduce(b,[{root:a},{root:c}]),g=e(f[0]),h=e(f[1]);return g!==h||g!==e.OBJECT&&g!==e.ARRAY?f[0]!==f[1]:JSON.stringify(f[0])!==JSON.stringify(f[1])}function d(){function b(b){a.tap(b,function(b){b.error(a.UNDEFINED)})}function d(){var b="";return function(c){function d(d){b=d===a.UNDEFINED?"":b||c(d)||""}return arguments.length?("function"==typeof c?this.tap(function(a){d(a)}):b=c,this):b}}function e(b){function c(a){a.value(a.head()),e=e||a.error()||""}var d=k.active(!1),e="";a.tap(b,c),k.active(d),j.value(e)}function f(b){var d=b||{};return i.signal("data").extend(function(a){return{dirty:function(b){return void 0===b?a.dirty():c(d,a.value(),b)}}}).prime(d).join({error:j},a.id).map(function(a){return d=a,a.error?void 0:a})["finally"](function(a){l.value(a)})}function g(a){return i.signal(a).extend({click:function(a,b){return a.pulse().value.bind(a,b||!0)}})}function h(c){return i.signal(c).extend({cta:function(b){return b=b||m,a.isSignal(b)||(b=a.signal(),b.join.apply(b,arguments)),a.signal().tap(function(a){a&&(e(b),this.active(void 0))})}}).tap(function(){b(this)})["finally"](function(a){k.value(a)})}var i=this,j=a.signal();i.signal=function(){return a.signal.apply(null,arguments).extend({error:d()})};var k=i.model=new f,l=i.view=new g,m=i.intent=new h;return i}a=a||require("circus");var e=a.typeOf;return a.mvi=function(){return new d}}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circusMVI:"function"==typeof define&&define.amd&&define(function(){return circusMVI});
//# sourceMappingURL=circus.min.js.map