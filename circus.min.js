/*
Circus.js v0.0.1
http://github.com/philtoms/circus.js
(c) Phil Toms
License: MIT
*/
var circus=function(){"use strict";function a(){}function b(a){if("object"==typeof a){if(a.length)return a.slice();var b={};return Object.keys(a).forEach(function(c){b[c]=a[c]}),b}return a}function c(b,d,e){var f=a.FALSE,g=e?b:b.value,h=i.call(g)[8];if(~l.indexOf(h)||void 0===g||void 0===d)f=g!==d;else if(void 0!==b.key)f=d[b.key]!==g[b.key]&&b.key||a.FALSE;else if(h===j){for(var m=0,n=g.length;n>m;m++)if(e&&c(g[m],d[m],e).dirty||g[m]!==d[m]){f=m;break}}else if(h===k){var o=Object.keys(g),p=Object.keys(d);f=o.length!=p.length||"object"!=typeof d||o.reduce(function(b,f){return b!==a.FALSE||e&&c(g[f],d[f],e).dirty||g[f]!==d[f]&&f||b},a.FALSE)}return{dirty:f,value:g}}function d(b,d){return c({value:b},d).dirty===a.FALSE}function e(b,d){return c(b,d,!0).dirty===a.FALSE}function f(a,b){var c=b.indexOf("[");if(c>0){var d=parseInt(b.substr(c+1,b.length-2),10),e=b.substr(0,c);return a[e][d]}return a[b]}function g(a,b){return b=b.split("."),b.reduce(f,a)}function h(a,b,c){return{model:a["finally"](function(){return this.feed(b)}),view:b,intent:c["finally"](function(){return this.feed(a)})}}var i={}.toString,j="A",k="O",l="SNBDR",m={copy:b,diff:c,equal:d,deepEqual:e,lens:g,fold:h,id:function(a){return a}};return Object.keys(m).forEach(function(b){a[b]=m[b]}),a}();"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circus:"function"==typeof define&&define.amd&&define(function(){return circus});var signal=function(a){"use strict";function b(c){function d(){if(p!==a.UNDEFINED){var b=p;p=a.UNDEFINED,b.forEach(function(a){r.value(a)})}}function e(){function b(a,b){for(var c=0,d=p.length;d>c;c+=1)p[c].call(a,b,g)}function c(){return(r>1?t[t.l]:t)||{dirty:!0,value:void 0}}function e(b,d,e){var g=c().value;k=d===b&&e(d,g)||{dirty:b===g&&a.FALSE||g,value:b},r>1?(f===r&&(t.shift(),f--),t.push(k)):t=k,t.l=f++}var f=(this.id=++i,0),p=[],r=q,t=r>1?[]:void 0;s?s.next=this:s=this,n=this,this.value=function(i,k,p){return d(),arguments.length?((h||void 0===h)&&(g=k,h=!0,i===a.UNDEFINED&&(i=void 0),r?e(i,p||j,a.diff):f++&&(t={dirty:!0,value:i}),b(this,i),n===this&&m&&o.reduce(function(a,b){return b.value(a),b.value()},i),l&&(h=void 0,e(void 0,j,a.diff))),this):f?c().value:r>1?[]:void 0},this.dirty=function(b){var d=c();return d.dirty!==a.FALSE||d.dirty===b},this.depth=function(b){return r=arguments.length?b:a.MAXDEPTH,r>1&&void 0===t&&(t=[]),this},this.history=function(){return f?(r>1?t:[t]).map(function(a){return a.value}):[]},this.lift=function(a){a&&p.push(a),s=s.next||s}}var f,g,h,k,l,m,n,o=[],p=a.UNDEFINED,q=1,r=new e,s=r;if(this.id=i,this.next=function(){return s.next||new e},this.step=function(){return s},this.value=function(a){return d(),arguments.length?(r.value(a),this):(m||n).value()},this.depth=r.depth,this.active=function(a){return void 0!==a?(h=!!a,this):!!h},this.lift=function(a){return s.lift(a),this},this.tap=this.lift,this.keep=function(b){return q=arguments.length?b:a.MAXDEPTH,r.depth(q),this},this.history=function(){return d(),(m||n).history()},this.name=function(a){return void 0!==a?(f=a,this):f},this.pulse=function(){return l=!0,this},this["finally"]=function(a){var c=new b;c.keep(q);var d=a.call(c);return d&&(m=m||d,o.unshift(d)),this},this.dirty=function(b){var c=k?k.dirty:!0;return c!==a.FALSE||c===b},this.map=function(c){var d=this,e=this.next(),f=/\(.+,.+,.+\)\s*[{=]/.test(c.toString());return this.lift(function(g,h){var i=[g,h];(f||a.alwaysDiff)&&(f={value:b.prototype.copy(g),dirty:d.dirty()},a.alwaysDiff?i=[f,h]:i.push(f));var j=c.apply(this,i);j!==a.FALSE&&(void 0===j&&(j=g),e.value(j,h,f))})},void 0!==c&&void 0!==c[0]){var t=this;[].slice.call(c).forEach(function(a){"string"==typeof a?f=a:a instanceof b?t.feed(a):p=a})}}function c(c,d,e,h){function i(a,h,i){var p=m[a]=o[a].name()||a;return h=h||n,i||(o[a]=o[a].step()),function(a){var i,n=o[0].value();o.reduce(f,!1)?(s?i=b.prototype.copy(n):(i={},q||(i[l]=n)),o.forEach(function(a,b){(b||!s)&&(i[m[b]]=a.value())})):(i=j.value(),i[p]=a);var r=!h||h.call(c,i,p);r&&(e&&(a=i,"object"==typeof r&&(a=r,r instanceof g&&(a=r.value,r.mask&&(a={},r=r.value,Object.keys(r).forEach(function(b){r[b]&&(a[b]=i[b])}))))),j.value(d?k.value():a,p))}}var j=c.next(),k=c.step(),l=c.name()||0,m=[l],n=h.tail,o=h.signals,p=o.shift();if("string"!=typeof p&&(o.unshift(p),p=!1),o.length){var q=o.pop();q instanceof b?(o.push(q),q=!1):Object.keys(q).forEach(function(b){var d=q[b]===a.id?c:q[b];d.name(b),o.push(d)})}d||q||o.unshift(c);var r=c.jp||{},s=c.jp&&e;p&&(m[0]=e?o[0].name()||0:void 0,r[p]={join:function(a,b){var c=o.length;o.push(a),a.lift(i(c,b))}}),c.jp=r,d&&c.lift(i(0,void 0,!0));for(var t=0,u=o.length;u>t;t++)o[t].lift(i(t));return c.lift()}function d(b,c,d){var f=e(c),c=f.signals,g=f.tail;return c.forEach(function(a){a.join(b,g)}),b.map(function(b){return d(g,b)?b:a.FALSE})}function e(a,c,d){var e;if(a=[].slice.call(a),a.length){var e=a.pop();(typeof e!==(d||"function")||e instanceof b)&&(a.push(e),e=c)}return{signals:a,tail:e}}function f(a,b){return a||b.dirty()}function g(a,b){this[a]=!0,this.value=b}function h(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}a=a||require("circus");{var i=0,j={};({}).toString}a.alwaysDiff=!1,a.FALSE=Object.freeze({"false":!0}),a.UNDEFINED=Object.freeze({undefined:!0}),a.MAXDEPTH=Number.MAX_SAFE_INTEGER||-1>>>1,b.prototype.feed=function(){var a=this,b=e(arguments),c=b.signals,d=b.tail;return c.forEach(function(b){a.lift(function(a){(!d||d(a))&&b.value(a)})}),this},b.prototype.diff=a.diff,b.prototype.copy=a.copy,b.prototype.join=function(){return c(this,!1,!0,e(arguments,k))},b.prototype.merge=function(){return c(this,!1,!1,e(arguments,k))},b.prototype.sample=function(){return c(this,!0,!1,e(arguments,k))},b.prototype.split=function(){return d(this,arguments,function(a,b){return!a||a(b)})},b.prototype["switch"]=function(){return d(this,arguments,function(a,b){return a&&!a(b)})},a.signal=function(){return new b(arguments)},a.signal.allActive=function(a){return Object.keys(a).reduce(function(b,c){return b&&void 0!==a[c]},!0)},a.signal.anyActive=function(a){return Object.keys(a).reduce(function(b,c){return b||void 0!==a[c]},!1)},a.signal.mask=function(a){return new g("mask",a)},a.signal.pick=function(a){return new g("pick",a)},a.signal.extendBy=function(a){h(b.prototype,a)};var k=(a.signal.allActive,a.signal.anyActive);return a.signal}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=signal:"function"==typeof define&&define.amd&&define(function(){return signal});var curcusModel=function(a){"use strict";function b(a,b){var c,d=a[0],g=a[1];return void 0===d||void 0===g?[!0,void 0]:(c=b.indexOf("["))>0?(e=parseInt(b.substr(c+1,b.length-2),10),f=b.substr(0,c),[d[f][e],g[f][e]]):[d[b],g[b]]}function c(a,c,d){"."!==d[0]&&(d="."+d),d=("root"+d).split(".");var e=d.reduce(b,[{root:a},{root:c}]),f=g.call(e[0]),h=g.call(e[1]);return f!==h||"[object Object]"!==f&&"[object Array]"!==f?e[0]!==e[1]:JSON.stringify(e[0])!==JSON.stringify(e[1])}function d(b){var d={},e=a.signal(b),f=e.value.bind(e);e.value=function(){return d=a.copy(f()),f.apply(this,arguments)};var g=e.dirty.bind(e);return e.dirty=function(a){return void 0===a?g():c(d,f(),a)},e}a=a||require("circus");var e,f,g={}.toString;return a.model=function(a){return new d(a)},a.model}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=curcusModel:"function"==typeof define&&define.amd&&define(function(){return curcusModel});var circusView=function(a){"use strict";function b(b){var c=a.signal(b);return c}return a=a||require("circus"),a.domEvent=function(b,c,d){var e=a.signal();return b.addEventListener(c,function(a){e.active(!0).value(a)}),d&&b.addEventListener(d,e.active.bind(e,!1)),e},a.view=function(a){return new b(a)}}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circusView:"function"==typeof define&&define.amd&&define(function(){return circusView});var circusIntent=function(a){"use strict";function b(b){var c={},d=a.signal(),e=a.signal(b)["finally"](function(){return this.join({model:a.id,error:d},a.signal.anyActive)});return e.signal=function(b){var c=a.signal(b);return c.error=e.error,c},e.error=function(a){var b=this.name()||"model",e=function(e,f){var g=f||a(e);c[b]&&g||(c[b]=g,d.value(c))};return"function"==typeof a?this.lift(e):e(null,a),this},e}return a=a||require("circus"),a.intent=function(a){return new b(a)}}(circus);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=circusIntent:"function"==typeof define&&define.amd&&define(function(){return circusIntent});
//# sourceMappingURL=circus.min.js.map